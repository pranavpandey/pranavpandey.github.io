<!--
@license
Copyright (c) 2016 Pranav Pandey.
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<dom-module id="pp-contact">
  <template>
    <style include="pp-styles"></style>

    <iron-ajax
      auto
      url="../../data/contact.json"
      handle-as="json"
      loading={{loading}}
      last-response="{{dataContact}}">
    </iron-ajax>

    <template is="dom-repeat" items="[[dataContact.contact]]" as="contactCategory">
      <h2 class="padding-horizontal">{{contactCategory.category}}</h2>
      <template is="dom-repeat" items="[[contactCategory.data]]" as="categoryData">
        <paper-card>
          <div class="card-content">
            <h2 class="card-title" hidden$="[[!categoryData.title]]">{{categoryData.title}}</h2>
            <h3 class="card-subtitle" hidden$="[[!categoryData.subtitle]]">{{categoryData.subtitle}}</h3>
            <p hidden$="[[!categoryData.description]]">{{categoryData.description}}</p>
          </div>

          <div class="card-actions" hidden$="[[isJSONEmpty(categoryData.links)]]">
            <template is="dom-repeat" items="[[categoryData.links]]" as="linksContact">
              <a class="paper-button" href$="[[linksContact.url]]" target="_blank" tabindex="-1">
                <paper-button style$="[[setColor(linksContact.accent)]]">
                  <iron-icon class="small" icon="[[linksContact.ironIcon]]"></iron-icon>
                  {{linksContact.link}}
                </paper-button>
              </a>
            </template>
          </div>
        </paper-card>
      </template>
    </template>

    <h2 class="padding-horizontal">Form</h2>

    <paper-card class="weight-half">
      <form is="iron-form" id="presubmit"
        action="https://formspree.io/YOUR_EMAIL_ID" method="post"
        on-iron-form-presubmit="_presubmit">
        <div id="captcha_container" class="card-content">
          <h3 class="card-subtitle">If you have any queries or anything good for me, you can contact me via this form.</h3>
          <input type="text" name="_gotcha" style="display:none" />
          <paper-input type="text" name="name" label="Name"
            floatingLabel required auto-validate
            error-message="Name cannot be empty!">
            <iron-icon class="small" icon="pp-icons:person" prefix></iron-icon>
          </paper-input>
          <paper-input name="_replyto" type="email" label="Email"
            floatingLabel required auto-validate
            error-message="Please enter your email id.">
            <iron-icon class="small" icon="pp-icons:mail" prefix></iron-icon>
          </paper-input>
          <paper-input type="text" name="_subject" label="Subject" floatingLabel
            required auto-validate error-message="Please enter subject.">
            <iron-icon class="small" icon="pp-icons:create" prefix></iron-icon>
          </paper-input>
          <paper-textarea id="message" type="text" label="Message"
            name="message" floatingLabel multiline rows="3" required
            placeholder="Something about your subject..."
            error-message="Message cannot be empty!">
          </paper-textarea>
          <br>
          <!-- <div class="g-recaptcha"></div> -->
        </div>
        <br/>
        <div class="card-actions">
          <paper-button id="btn_submit" type="submit"
            class="secondary" on-tap="_submit" raised>
            <iron-icon class="small" icon="pp-icons:submit"></iron-icon>
            Submit
          </paper-button>
          <paper-button class="secondary" on-tap="_reset">
            <iron-icon class="small" icon="pp-icons:reset"></iron-icon>
            Reset
          </paper-button>
        </div>
      </form>
    </paper-card>

    <paper-card class="weight-half">
      <google-map latitude="LATITUDE" longitude="LONGITUDE"
         api-key="YOUR_API_KEY" zoom="13">
        <google-map-marker latitude="LATITUDE" longitude="LONGITUDE"
          title="TITLE" draggable="true">
        </google-map-marker>
      </google-map>

      <div class="card-content">
        <h3 class="card-subtitle no-vertical-margin">
          YOUR_LOCATION
        </h3>
      </div>
    </paper-card>

    <paper-toast id="toast" text="Thanks for contacting me. I will get back to you soon!"></paper-toast>
  </template>

  <script>
    Polymer({
      is: 'pp-contact',

      properties: {
        loading: {
          type: Boolean,
          value: false,
          notify: true
        }
      },

      listeners: {
        'reset-form': '_reset'
      },

      // attached: function() {
      //     grecaptcha.render(this.$.captcha_container.querySelector('.g-recaptcha'), {
      //       'sitekey': 'YOUR_API_KEY',
      //       'callback': function(event) {
      //         console.info('EnableSubmit');
      //         document.querySelector('#btn_submit').disabled = false;
      //       },
      //       'expired-callback': function(event) {
      //         console.info('DisableSubmit');
      //         document.querySelector('#btn_submit').disabled = true;
      //       }
      //     });
      // },

      // ready() is called when element is ready at load time.
      ready: function() {
        this.$.presubmit.addEventListener('iron-form-submit', function(event) {
          // var iron_ajax = this.querySelector('#submitResponse');
          // iron_ajax.body = event.target.request.body;
          // iron_ajax.generateRequest();
          // this.fire('reset-form');
          this.fire('show-toast', { "text": "Thanks for contacting me. I will get back to you soon!" });
          console.log('SubmitData', JSON.stringify(event.detail));
        });
      },

      isJSONEmpty: function(obj) {
        return !obj.length ||
          !obj.filter(function(a){return Object.keys(a).length;}).length;
      },

      setColor: function(color) {
        var style = "color:" + color;
        return style;
      },

      _presubmit: function(event) {
        var body = Polymer.dom(event).localTarget.request.body;
        var subject = body['_subject'];
        body['_subject'] = '[Website Contact] ' + subject;
        console.log('PresubmitData', JSON.stringify(body));
        Polymer.dom(event).localTarget.reset();
      },

      _submit: function(event) {
        Polymer.dom(event).localTarget.parentElement.parentElement.submit();
      },

      _reset: function(event) {
        var form = Polymer.dom(event).localTarget.parentElement.parentElement;
        form.reset();
        // grecaptcha.reset();
        // document.querySelector('#btn_submit').disabled = true;
      }
    });
  </script>
</dom-module>
